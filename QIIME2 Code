QIIME2 Code

# Create a directory for your project and navigate to it
# Feel free to change the working directory from data to something else
mkdir /data/deer_project2
cd /data/deer_project2

# Import data & demultiplex using the mainfest file while working directory is `/data/deer_project2`
qiime tools import \
  --type "SampleData[PairedEndSequencesWithQuality]" \
  --input-format PairedEndFastqManifestPhred33V2 \
  --input-path /datasets/project_2/prion/deer2_manifest.txt \
  --output-path demux_quality.qza

# Look at artifact information
qiime tools peek demux_quality.qza

# Create visualization of demultiplexed samples
qiime demux summarize \
  --i-data demux_quality.qza \
  --o-visualization demux_quality.qzv

# Make directory in home directory on LOCAL machine
mkdir deer_project2
cd deer_project2

# Copy file
scp root@10.19.139.157:/data/deer_project2/demux_quality.qzv . # Include period!!!

# Once you have the demux.qzv file, send it to Evelyn to confirm trimming before moving forward!

# Determine ASVs with DADA2 with chosen left and right trimming parameters!
qiime dada2 denoise-paired \
  --i-demultiplexed-seqs demux_quality.qza \
  --p-trim-left-f 0 \
  --p-trunc-len-f 250 \
  --p-trim-left-r 0 \
  --p-trunc-len-r 250 \
  --o-representative-sequences rep-seqs.qza \
  --o-table table.qza \
  --o-denoising-stats stats.qza

# Visualize ASVs stats
qiime feature-table summarize \
  --i-table table.qza \
  --o-visualization table.qzv \
  --m-sample-metadata-file /data/deer2_metadata_updated.tsv
  
qiime feature-table tabulate-seqs \
  --i-data rep-seqs.qza \
  --o-visualization rep-seqs.qzv

# Create a new classifier
qiime feature-classifier extract-reads \
  --i-sequences /datasets/classifiers/silva_ref_files/silva-138-99-seqs.qza \
  --p-f-primer TCGTCGGCAGCGTCAGATGTGTATAAGAGACAGCCTACGGGNGGCWGCAG \
  --p-r-primer GTCTCGTGGGCTCGGAGATGTGTATAAGAGACAGGACTACHVGGGTATCTAATCC \
  --p-trunc-len 250 \
  --o-reads ref-seqs.qza

# Taxonomic analysis
qiime feature-classifier classify-sklearn \
  --i-classifier ref-seqs.qza \
  --i-reads rep-seqs.qza \
  --o-classification taxonomy.qza

qiime metadata tabulate \
  --m-input-file taxonomy.qza \
  --o-visualization taxonomy.qzv
  
# Taxonomy barplots
qiime taxa barplot \
  --i-table table.qza \
  --i-taxonomy taxonomy.qza \
  --m-metadata-file /datasets/project_1/moving_pictures/sample-metadata.tsv \
  --o-visualization taxa-bar-plots.qzv

# Generate a tree for phylogenetic diversity analyses
qiime phylogeny align-to-tree-mafft-fasttree \
  --i-sequences rep-seqs.qza \
  --o-alignment aligned-rep-seqs.qza \
  --o-masked-alignment masked-aligned-rep-seqs.qza \
  --o-tree unrooted-tree.qza \
  --o-rooted-tree rooted-tree.qza

# Convert the table.qza into a text file
qiime tools export \
  --input-path table.qza \
  --output-path table_export 

biom convert \
  -i table_export/feature-table.biom \
  --to-tsv \
  -o feature-table.txt

# Convert the rooted-tree.qza to nwk
qiime tools export \
  --input-path rooted-tree.qza \
  --output-path tree_export

# Convert the taxonomy.qza to tsv
qiime tools export \
  --input-path taxonomy.qza \
  --output-path taxa_export
